(function(K,J){typeof exports=="object"&&typeof module<"u"?J(exports):typeof define=="function"&&define.amd?define(["exports"],J):(K=typeof globalThis<"u"?globalThis:K||self,J(K.papiPjsSigner={}))})(this,function(K){"use strict";var J=Object.defineProperty,wt=(e,t,n)=>t in e?J(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Be=(e,t,n)=>(wt(e,typeof t!="symbol"?t+"":t,n),n),ce={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15,A:10,B:11,C:12,D:13,E:14,F:15};function bt(e){const t=e.length%2,n=(e[1]==="x"?2:0)+t,s=(e.length-n)/2+t,r=new Uint8Array(s);t&&(r[0]=0|ce[e[2]]);for(let o=0;o<s;){const i=n+o*2,c=ce[e[i]],d=ce[e[i+1]];r[t+o++]=c<<4|d}return r}var Ie=class extends Uint8Array{constructor(e){super(e),Be(this,"i",0),Be(this,"v"),this.v=new DataView(e)}},C=e=>t=>e(t instanceof Ie?t:new Ie(t instanceof Uint8Array?t.buffer:typeof t=="string"?bt(t).buffer:t)),L=e=>{const t=e.length;let n=0;for(let r=0;r<t;r++)n+=e[r].length;const s=new Uint8Array(n);for(let r=0,o=0;r<t;r++){const i=e[r];s.set(i,o),o+=i.byteLength}return s};function ne(e,t){const n=Object.keys(e),s=n.length,r={};for(let o=0;o<s;o++){const i=n[o];r[i]=t(e[i],i)}return r}var I=(e,t)=>{const n=[e,t];return n.enc=e,n.dec=t,n},ke=(e,t)=>n=>e(t(n)),Ue=(e,t)=>n=>t(e(n)),Q=([e,t],n,s)=>I(ke(e,n),Ue(t,s));function xt(e,t){return C(n=>{const s=n.v[t](n.i,!0);return n.i+=e,s})}function Et(e,t){return n=>{const s=new Uint8Array(e);return new DataView(s.buffer)[t](0,n,!0),s}}function M(e,t,n){return I(Et(e,n),xt(e,t))}var k=M(1,"getUint8","setUint8"),re=M(2,"getUint16","setUint16"),V=M(4,"getUint32","setUint32"),Te=M(8,"getBigUint64","setBigUint64");M(1,"getInt8","setInt8"),M(2,"getInt16","setInt16"),M(4,"getInt32","setInt32"),M(8,"getBigInt64","setBigInt64");var _e=e=>{const t=new Uint8Array(16),n=new DataView(t.buffer);return n.setBigInt64(0,e,!0),n.setBigInt64(8,e>>64n,!0),t},De=e=>C(t=>{const{v:n,i:s}=t,r=n.getBigUint64(s,!0),o=n[e](s+8,!0);return t.i+=16,o<<64n|r});I(_e,De("getBigUint64")),I(_e,De("getBigInt64"));var Oe=e=>{const t=new Uint8Array(32),n=new DataView(t.buffer);return n.setBigInt64(0,e,!0),n.setBigInt64(8,e>>64n,!0),n.setBigInt64(16,e>>128n,!0),n.setBigInt64(24,e>>192n,!0),t},Ce=e=>C(t=>{let n=t.v.getBigUint64(t.i,!0);return t.i+=8,n|=t.v.getBigUint64(t.i,!0)<<64n,t.i+=8,n|=t.v.getBigUint64(t.i,!0)<<128n,t.i+=8,n|=t.v[e](t.i,!0)<<192n,t.i+=8,n});I(Oe,Ce("getBigUint64")),I(Oe,Ce("getBigInt64")),Q(k,e=>e?1:0,Boolean);var At=[k[1],re[1],V[1]],Bt=C(e=>{const t=e[e.i],n=t&3;if(n<3)return At[n](e)>>>2;const s=(t>>>2)+4;e.i++;let r=0n;const o=s/8|0;let i=0n;for(let d=0;d<o;d++)r=Te[1](e)<<i|r,i+=64n;let c=s%8;return c>3&&(r=BigInt(V[1](e))<<i|r,i+=32n,c-=4),c>1&&(r=BigInt(re[1](e))<<i|r,i+=16n,c-=2),c&&(r=BigInt(k[1](e))<<i|r),r}),It=1n<<56n,kt=1<<24,Ut=256,Tt=4294967295n,_t=64,Dt=16384,Ot=1<<30,Ct=e=>{if(e<0)throw new Error(`Wrong compact input (${e})`);const t=Number(e)<<2;if(e<_t)return k[0](t);if(e<Dt)return re[0](t|1);if(e<Ot)return V[0](t|2);let n=[new Uint8Array(1)],s=BigInt(e);for(;s>=It;)n.push(Te[0](s)),s>>=64n;s>=kt&&(n.push(V[0](Number(s&Tt))),s>>=32n);let r=Number(s);r>=Ut&&(n.push(re[0](r)),r>>=16),r&&n.push(k[0](r));const o=L(n);return o[0]=o.length-5<<2|3,o},D=I(Ct,Bt),Lt=new TextEncoder,St=e=>{const t=Lt.encode(e);return L([D.enc(t.length),t])},jt=new TextDecoder,Mt=C(e=>{let t=D.dec(e);const n=new DataView(e.buffer,e.i,t);return e.i+=t,jt.decode(n)}),b=I(St,Mt),Vt=()=>{},Nt=new Uint8Array(0),x=I(()=>Nt,Vt),Le=e=>e===void 0?t=>L([D.enc(t.length),t]):t=>t.length===e?t:t.slice(0,e),Se=e=>C(t=>{const n=e===void 0?D.dec(t):e!==1/0?e:t.byteLength-t.i,s=new Uint8Array(t.buffer.slice(t.i,t.i+n));return t.i+=n,s}),q=e=>I(Le(e),Se(e));q.enc=Le,q.dec=Se;var je=(e,t)=>{const n=Object.keys(e),s=new Map(t?.map((o,i)=>[n[i],o])??n.map((o,i)=>[o,i])),r=o=>s.get(o);return({tag:o,value:i})=>L([k.enc(r(o)),e[o](i)])},Me=(e,t)=>{const n=Object.keys(e),s=new Map(t?.map((r,o)=>[r,n[o]])??n.map((r,o)=>[o,r]));return C(r=>{const o=k.dec(r),i=s.get(o),c=e[i];return{tag:i,value:c(r)}})},S=(e,...t)=>I(je(ne(e,([n])=>n),...t),Me(ne(e,([,n])=>n),...t));S.enc=je,S.dec=Me;var Ve=e=>C(t=>k[1](t)>0?e(t):void 0),Ne=e=>t=>{const n=new Uint8Array(1);return t===void 0?n:(n[0]=1,L([n,e(t)]))},U=e=>I(Ne(e[0]),Ve(e[1]));U.enc=Ne,U.dec=Ve;var Pe=(...e)=>C(t=>e.map(n=>n(t))),$e=(...e)=>t=>L(e.map((n,s)=>n(t[s]))),N=(...e)=>I($e(...e.map(([t])=>t)),Pe(...e.map(([,t])=>t)));N.enc=$e,N.dec=Pe;var He=e=>{const t=Object.keys(e);return ke(N.enc(...Object.values(e)),n=>t.map(s=>n[s]))},Re=e=>{const t=Object.keys(e);return Ue(N.dec(...Object.values(e)),n=>Object.fromEntries(n.map((s,r)=>[t[r],s])))},f=e=>I(He(ne(e,t=>t[0])),Re(ne(e,t=>t[1])));f.enc=He,f.dec=Re;var Fe=(e,t)=>t>=0?n=>L(n.map(e)):n=>L([D.enc(n.length),L(n.map(e))]),Ke=(e,t)=>C(n=>{const s=t>=0?t:D.dec(n),r=new Array(s);for(let o=0;o<s;o++)r[o]=e(n);return r}),m=(e,t)=>I(Fe(e[0],t),Ke(e[1],t));m.enc=Fe,m.dec=Ke;/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Pt(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function qe(e,t){return Array.isArray(t)?t.length===0?!0:e?t.every(n=>typeof n=="string"):t.every(n=>Number.isSafeInteger(n)):!1}function ae(e,t){if(typeof t!="string")throw new Error(`${e}: string expected`);return!0}function We(e){if(!Number.isSafeInteger(e))throw new Error(`invalid integer: ${e}`)}function le(e){if(!Array.isArray(e))throw new Error("array expected")}function Xe(e,t){if(!qe(!0,t))throw new Error(`${e}: array of strings expected`)}function $t(e,t){if(!qe(!1,t))throw new Error(`${e}: array of numbers expected`)}function Ht(...e){const t=o=>o,n=(o,i)=>c=>o(i(c)),s=e.map(o=>o.encode).reduceRight(n,t),r=e.map(o=>o.decode).reduce(n,t);return{encode:s,decode:r}}function Rt(e){const t=typeof e=="string"?e.split(""):e,n=t.length;Xe("alphabet",t);const s=new Map(t.map((r,o)=>[r,o]));return{encode:r=>(le(r),r.map(o=>{if(!Number.isSafeInteger(o)||o<0||o>=n)throw new Error(`alphabet.encode: digit index outside alphabet "${o}". Allowed: ${e}`);return t[o]})),decode:r=>(le(r),r.map(o=>{ae("alphabet.decode",o);const i=s.get(o);if(i===void 0)throw new Error(`Unknown letter: "${o}". Allowed: ${e}`);return i}))}}function Ft(e=""){return ae("join",e),{encode:t=>(Xe("join.decode",t),t.join(e)),decode:t=>(ae("join.decode",t),t.split(e))}}function Ge(e,t,n){if(t<2)throw new Error(`convertRadix: invalid from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: invalid to=${n}, base cannot be less than 2`);if(le(e),!e.length)return[];let s=0;const r=[],o=Array.from(e,c=>{if(We(c),c<0||c>=t)throw new Error(`invalid integer: ${c}`);return c}),i=o.length;for(;;){let c=0,d=!0;for(let g=s;g<i;g++){const h=o[g],u=t*c,a=u+h;if(!Number.isSafeInteger(a)||u/t!==c||a-h!==u)throw new Error("convertRadix: carry overflow");const w=a/n;c=a%n;const y=Math.floor(w);if(o[g]=y,!Number.isSafeInteger(y)||y*n+c!==a)throw new Error("convertRadix: carry overflow");if(d)y?d=!1:s=g;else continue}if(r.push(c),d)break}for(let c=0;c<e.length-1&&e[c]===0;c++)r.push(0);return r.reverse()}function Kt(e){We(e);const t=2**8;return{encode:n=>{if(!Pt(n))throw new Error("radix.encode input should be Uint8Array");return Ge(Array.from(n),t,e)},decode:n=>($t("radix.decode",n),Uint8Array.from(Ge(n,e,t)))}}const ze=(e=>Ht(Kt(58),Rt(e),Ft("")))("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function qt(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function ue(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function he(e,...t){if(!qt(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function Ye(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Wt(e,t){he(e);const n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function se(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function de(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}const Je=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Qe(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}const j=Je?e=>e:e=>Qe(e);function Xt(e){for(let t=0;t<e.length;t++)e[t]=Qe(e[t]);return e}const X=Je?e=>e:Xt;function Gt(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function Z(e){return typeof e=="string"&&(e=Gt(e)),he(e),e}class zt{}function Yt(e){const t=(s,r)=>e(r).update(Z(s)).digest(),n=e({});return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=s=>e(s),t}const Jt=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),oe=BigInt(2**32-1),Ze=BigInt(32);function Qt(e,t=!1){return t?{h:Number(e&oe),l:Number(e>>Ze&oe)}:{h:Number(e>>Ze&oe)|0,l:Number(e&oe)|0}}const et=(e,t,n)=>e>>>n|t<<32-n,tt=(e,t,n)=>e<<32-n|t>>>n,Zt=(e,t,n)=>e<<64-n|t>>>n-32,en=(e,t,n)=>e>>>n-32|t<<64-n,tn=(e,t)=>t,nn=(e,t)=>e;function nt(e,t,n,s){const r=(t>>>0)+(s>>>0);return{h:e+n+(r/2**32|0)|0,l:r|0}}const rt=(e,t,n)=>(e>>>0)+(t>>>0)+(n>>>0),st=(e,t,n,s)=>t+n+s+(e/2**32|0)|0,B=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),l=new Uint32Array(32);function P(e,t,n,s,r,o){const i=r[o],c=r[o+1];let d=l[2*e],g=l[2*e+1],h=l[2*t],u=l[2*t+1],a=l[2*n],w=l[2*n+1],y=l[2*s],v=l[2*s+1],E=rt(d,h,i);g=st(E,g,u,c),d=E|0,{Dh:v,Dl:y}={Dh:v^g,Dl:y^d},{Dh:v,Dl:y}={Dh:tn(v,y),Dl:nn(v)},{h:w,l:a}=nt(w,a,v,y),{Bh:u,Bl:h}={Bh:u^w,Bl:h^a},{Bh:u,Bl:h}={Bh:et(u,h,24),Bl:tt(u,h,24)},l[2*e]=d,l[2*e+1]=g,l[2*t]=h,l[2*t+1]=u,l[2*n]=a,l[2*n+1]=w,l[2*s]=y,l[2*s+1]=v}function $(e,t,n,s,r,o){const i=r[o],c=r[o+1];let d=l[2*e],g=l[2*e+1],h=l[2*t],u=l[2*t+1],a=l[2*n],w=l[2*n+1],y=l[2*s],v=l[2*s+1],E=rt(d,h,i);g=st(E,g,u,c),d=E|0,{Dh:v,Dl:y}={Dh:v^g,Dl:y^d},{Dh:v,Dl:y}={Dh:et(v,y,16),Dl:tt(v,y,16)},{h:w,l:a}=nt(w,a,v,y),{Bh:u,Bl:h}={Bh:u^w,Bl:h^a},{Bh:u,Bl:h}={Bh:Zt(u,h,63),Bl:en(u,h,63)},l[2*e]=d,l[2*e+1]=g,l[2*t]=h,l[2*t+1]=u,l[2*n]=a,l[2*n+1]=w,l[2*s]=y,l[2*s+1]=v}function rn(e,t={},n,s,r){if(ue(n),e<0||e>n)throw new Error("outputLen bigger than keyLen");const{key:o,salt:i,personalization:c}=t;if(o!==void 0&&(o.length<1||o.length>n))throw new Error("key length must be undefined or 1.."+n);if(i!==void 0&&i.length!==s)throw new Error("salt must be undefined or "+s);if(c!==void 0&&c.length!==r)throw new Error("personalization must be undefined or "+r)}class sn extends zt{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,ue(t),ue(n),this.blockLen=t,this.outputLen=n,this.buffer=new Uint8Array(t),this.buffer32=se(this.buffer)}update(t){Ye(this),t=Z(t),he(t);const{blockLen:n,buffer:s,buffer32:r}=this,o=t.length,i=t.byteOffset,c=t.buffer;for(let d=0;d<o;){this.pos===n&&(X(r),this.compress(r,0,!1),X(r),this.pos=0);const g=Math.min(n-this.pos,o-d),h=i+d;if(g===n&&!(h%4)&&d+g<o){const u=new Uint32Array(c,h,Math.floor((o-d)/4));X(u);for(let a=0;d+n<o;a+=r.length,d+=n)this.length+=n,this.compress(u,a,!1);X(u);continue}s.set(t.subarray(d,d+g),this.pos),this.pos+=g,this.length+=g,d+=g}return this}digestInto(t){Ye(this),Wt(t,this);const{pos:n,buffer32:s}=this;this.finished=!0,de(this.buffer.subarray(n)),X(s),this.compress(s,0,!0),X(s);const r=se(t);this.get().forEach((o,i)=>r[i]=j(o))}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const s=t.slice(0,n);return this.destroy(),s}_cloneInto(t){const{buffer:n,length:s,finished:r,destroyed:o,outputLen:i,pos:c}=this;return t||(t=new this.constructor({dkLen:i})),t.set(...this.get()),t.buffer.set(n),t.destroyed=o,t.finished=r,t.length=s,t.pos=c,t.outputLen=i,t}clone(){return this._cloneInto()}}class on extends sn{constructor(t={}){const n=t.dkLen===void 0?64:t.dkLen;super(128,n),this.v0l=B[0]|0,this.v0h=B[1]|0,this.v1l=B[2]|0,this.v1h=B[3]|0,this.v2l=B[4]|0,this.v2h=B[5]|0,this.v3l=B[6]|0,this.v3h=B[7]|0,this.v4l=B[8]|0,this.v4h=B[9]|0,this.v5l=B[10]|0,this.v5h=B[11]|0,this.v6l=B[12]|0,this.v6h=B[13]|0,this.v7l=B[14]|0,this.v7h=B[15]|0,rn(n,t,64,16,16);let{key:s,personalization:r,salt:o}=t,i=0;if(s!==void 0&&(s=Z(s),i=s.length),this.v0l^=this.outputLen|i<<8|65536|1<<24,o!==void 0){o=Z(o);const c=se(o);this.v4l^=j(c[0]),this.v4h^=j(c[1]),this.v5l^=j(c[2]),this.v5h^=j(c[3])}if(r!==void 0){r=Z(r);const c=se(r);this.v6l^=j(c[0]),this.v6h^=j(c[1]),this.v7l^=j(c[2]),this.v7h^=j(c[3])}if(s!==void 0){const c=new Uint8Array(this.blockLen);c.set(s),this.update(c)}}get(){let{v0l:t,v0h:n,v1l:s,v1h:r,v2l:o,v2h:i,v3l:c,v3h:d,v4l:g,v4h:h,v5l:u,v5h:a,v6l:w,v6h:y,v7l:v,v7h:E}=this;return[t,n,s,r,o,i,c,d,g,h,u,a,w,y,v,E]}set(t,n,s,r,o,i,c,d,g,h,u,a,w,y,v,E){this.v0l=t|0,this.v0h=n|0,this.v1l=s|0,this.v1h=r|0,this.v2l=o|0,this.v2h=i|0,this.v3l=c|0,this.v3h=d|0,this.v4l=g|0,this.v4h=h|0,this.v5l=u|0,this.v5h=a|0,this.v6l=w|0,this.v6h=y|0,this.v7l=v|0,this.v7h=E|0}compress(t,n,s){this.get().forEach((d,g)=>l[g]=d),l.set(B,16);let{h:r,l:o}=Qt(BigInt(this.length));l[24]=B[8]^o,l[25]=B[9]^r,s&&(l[28]=~l[28],l[29]=~l[29]);let i=0;const c=Jt;for(let d=0;d<12;d++)P(0,4,8,12,t,n+2*c[i++]),$(0,4,8,12,t,n+2*c[i++]),P(1,5,9,13,t,n+2*c[i++]),$(1,5,9,13,t,n+2*c[i++]),P(2,6,10,14,t,n+2*c[i++]),$(2,6,10,14,t,n+2*c[i++]),P(3,7,11,15,t,n+2*c[i++]),$(3,7,11,15,t,n+2*c[i++]),P(0,5,10,15,t,n+2*c[i++]),$(0,5,10,15,t,n+2*c[i++]),P(1,6,11,12,t,n+2*c[i++]),$(1,6,11,12,t,n+2*c[i++]),P(2,7,8,13,t,n+2*c[i++]),$(2,7,8,13,t,n+2*c[i++]),P(3,4,9,14,t,n+2*c[i++]),$(3,4,9,14,t,n+2*c[i++]);this.v0l^=l[0]^l[16],this.v0h^=l[1]^l[17],this.v1l^=l[2]^l[18],this.v1h^=l[3]^l[19],this.v2l^=l[4]^l[20],this.v2h^=l[5]^l[21],this.v3l^=l[6]^l[22],this.v3h^=l[7]^l[23],this.v4l^=l[8]^l[24],this.v4h^=l[9]^l[25],this.v5l^=l[10]^l[26],this.v5h^=l[11]^l[27],this.v6l^=l[12]^l[28],this.v6h^=l[13]^l[29],this.v7l^=l[14]^l[30],this.v7h^=l[15]^l[31],de(l)}destroy(){this.destroyed=!0,de(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const fe=Yt(e=>new on(e)),ot=new TextEncoder().encode("SS58PRE"),pe=2,cn=e=>{try{const t=ze.decode(e),n=t.subarray(0,t[0]&64?2:1),s=t.subarray(n.length,t.length-pe),r=t.subarray(n.length+s.length),o=fe(Uint8Array.of(...ot,...n,...s),{dkLen:64}).subarray(0,pe);return r[0]===o[0]&&r[1]===o[1]?{isValid:!0,ss58Format:an(n),publicKey:s.slice()}:{isValid:!1}}catch{return{isValid:!1}}},an=e=>{const t=new DataView(e.buffer,e.byteOffset,e.byteLength);return t.byteLength===1?t.getUint8(0):t.getUint16(0)},ln=e=>{const t=e<64?Uint8Array.of(e):Uint8Array.of((e&252)>>2|64,e>>8|(e&3)<<6);return n=>{const s=fe(Uint8Array.of(...ot,...t,...n),{dkLen:64}).subarray(0,pe);return ze.encode(Uint8Array.of(...t,...n,...s))}};function un(e,t){return n=>{const s=cn(n);if(!s.isValid)throw new Error("Invalid checksum");const{publicKey:r}=s;if(r.length!==e)throw new Error("Invalid public key length");return r}}const hn=(e=42,t=32)=>Q(q(t),un(t),ln(e)),it="0123456789abcdef";function H(e){const t=new Array(e.length+1);t[0]="0x";for(let n=0;n<e.length;){const s=e[n++];t[n]=it[s>>4]+it[s&15]}return t.join("")}const ve={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15,A:10,B:11,C:12,D:13,E:14,F:15};function ee(e){const t=e.length%2,n=(e[1]==="x"?2:0)+t,s=(e.length-n)/2+t,r=new Uint8Array(s);t&&(r[0]=0|ve[e[2]]);for(let o=0;o<s;){const i=n+o*2,c=ve[e[i]],d=ve[e[i+1]];r[t+o++]=c<<4|d}return r}const ct=(...e)=>{const t=Array.isArray(e[0])?e[0]:e,n=t.reduce((r,o)=>r+o.byteLength,0),s=new Uint8Array(n);for(let r=0,o=0;r<t.length;r++){const i=t[r];s.set(i,o),o+=i.byteLength}return s},p=Q(D,e=>e,Number),dn=Q(D,e=>e,BigInt),at=e=>{const t=q.enc(e);return n=>t(ee(n))},lt=e=>{const t=q.dec(e);return n=>H(t(n))},R=e=>I(at(e),lt(e));R.enc=at,R.dec=lt;const G=(e,t)=>{const n=e;return n.inner=t,n},ye=e=>G(f(e),e);ye.enc=e=>G(f.enc(e),e),ye.dec=e=>G(f.dec(e),e);const ge=e=>G(U(e),e);ge.enc=e=>G(U.enc(e),e),ge.dec=e=>G(U.dec(e),e);const _=m(b),ut=U(b),fn=S({bool:x,char:x,str:x,u8:x,u16:x,u32:x,u64:x,u128:x,u256:x,i8:x,i16:x,i32:x,i64:x,i128:x,i256:x}),ht=m(f({name:ut,type:p,typeName:ut,docs:_})),pn=f({len:V,type:p}),vn=f({bitStoreType:p,bitOrderType:p}),yn=m(f({name:b,fields:ht,index:k,docs:_})),gn=S({composite:ht,variant:yn,sequence:p,array:pn,tuple:m(p),primitive:fn,compact:p,bitSequence:vn}),mn=f({name:b,type:U(p)}),wn=m(mn),bn=f({id:p,path:_,params:wn,def:gn,docs:_}),me=m(bn),z=S({NotDeprecated:x,DeprecatedWithoutNote:x,Deprecated:f({note:b,since:U(b)})}),xn=m(f({index:k,deprecation:S({DeprecatedWithoutNote:x,Deprecated:f({note:b,since:U(b)})},[1,2])})),we={name:b,inputs:m(f({name:b,type:p})),output:p,docs:_},En=f({name:b,methods:m(f(we)),docs:_}),An=f({name:b,methods:m(f({...we,deprecationInfo:z})),docs:_,version:p,deprecationInfo:z}),Bn=f({id:R(32),...we,deprecationInfo:z}),In=S({Blake2128:x,Blake2256:x,Blake2128Concat:x,Twox128:x,Twox256:x,Twox64Concat:x,Identity:x}),kn=m(In),Un=f({hashers:kn,key:p,value:p}),dt={name:b,modifier:k,type:S({plain:p,map:Un}),fallback:R(),docs:_},be=U(p),ft={name:b,storage:U(f({prefix:b,items:m(f(dt))})),calls:be,events:be,constants:m(f({name:b,type:p,value:R(),docs:_})),errors:be,index:k},Tn={...ft,docs:_},xe=U(f({type:p,deprecationInfo:xn})),_n={name:b,storage:U(f({prefix:b,items:m(f({...dt,deprecationInfo:z}))})),calls:xe,events:xe,constants:m(f({name:b,type:p,value:R(),docs:_,deprecationInfo:z})),errors:xe,associatedTypes:m(f({name:b,type:p,docs:_})),viewFns:m(Bn),index:k,docs:_,deprecationInfo:z},Dn=new Uint8Array,pt=e=>I(()=>Dn,()=>e),On=f({type:p,version:k,signedExtensions:m(f({identifier:b,type:p,additionalSigned:p}))}),Cn=f({lookup:me,pallets:m(f({...ft,docs:pt([])})),extrinsic:On,type:p,apis:pt([])}),Ln=f({version:k,address:p,call:p,signature:p,extra:p,signedExtensions:m(f({identifier:b,type:p,additionalSigned:p}))}),Sn=f({lookup:me,pallets:m(f(Tn)),extrinsic:Ln,type:p,apis:m(En),outerEnums:f({call:p,event:p,error:p}),custom:m(N(b,f({type:p,value:R()})))}),jn=f({version:m(k),address:p,call:p,signature:p,signedExtensionsByVersion:m(N(k,m(p))),signedExtensions:m(f({identifier:b,type:p,additionalSigned:p}))}),Mn=f({lookup:me,pallets:m(f(_n)),extrinsic:jn,apis:m(An),outerEnums:f({call:p,event:p,error:p}),custom:m(N(b,f({type:p,value:R()})))}),vt=()=>{throw new Error("Unsupported metadata version!")},T=I(vt,vt),ie=f({magicNumber:V,metadata:S({v0:T,v1:T,v2:T,v3:T,v4:T,v5:T,v6:T,v7:T,v8:T,v9:T,v10:T,v11:T,v12:T,v13:T,v14:Cn,v15:Sn,v16:Mn})}),Ee=q(),Vn=U(Ee),Nn=N(D,Ee),Pn=e=>{try{return ie.dec(e)}catch{}try{return ie.dec(Vn.dec(e))}catch{}try{return ie.dec(Ee.dec(e))}catch{}try{return ie.dec(Nn.dec(e)[1])}catch{}throw null},$n=e=>{if("magicNumber"in e&&(e=e.metadata),"tag"in e){if(e.tag!=="v14"&&e.tag!=="v15"&&e.tag!=="v16")throw new Error("Only metadata 14, 15, and 16 are supported");e=e.value}if("signedExtensionsByVersion"in e.extrinsic)return{version:16,...e};if("custom"in e){const{lookup:r,extrinsic:o,custom:i,apis:c,pallets:d,outerEnums:g}=e;return{version:15,lookup:r,pallets:d.map(h=>({...h,calls:h.calls!=null?{type:h.calls}:void 0,events:h.events!=null?{type:h.events}:void 0,errors:h.errors!=null?{type:h.errors}:void 0,viewFns:[],associatedTypes:[]})),extrinsic:{...o,version:[o.version]},apis:c,outerEnums:g,custom:i}}const{lookup:t,extrinsic:n,pallets:s}=e;return{version:14,lookup:t,pallets:s.map(r=>({...r,calls:r.calls!=null?{type:r.calls}:void 0,events:r.events!=null?{type:r.events}:void 0,errors:r.errors!=null?{type:r.errors}:void 0,viewFns:[],associatedTypes:[]})),extrinsic:{...n,version:[n.version]},apis:[]}},W={bare:0,0:"bare",general:1,1:"general",signed:2,2:"signed"},Hn=Q(k,({version:e,type:t})=>e+(W[t]<<6),e=>{const t=e&63,n=e>>6;if(t===4&&(n===W.bare||n===W.signed))return{version:t,type:W[n]};if(t===5&&(n===W.bare||n===W.general))return{version:t,type:W[n]};throw new Error(`ExtrinsicFormat ${e} not valid`)}),Rn={dkLen:32},Fn=e=>fe(e,Rn),yt=(e,t)=>e.type==="array"&&e.len===t&&e.value.type==="primitive"&&e.value.value==="u8",F={type:"void"},Kn=(e,t=()=>null)=>{const n=new Map,s=new Set,r=h=>u=>{let a=n.get(u);if(a)return a;if(s.has(u)){const y={id:u};return n.set(u,y),y}s.add(u);const w=h(u);return a=n.get(u),a?Object.assign(a,w):(a={id:u,...w},n.set(u,a)),s.delete(u),a};let o=!0,i=!0;const c=r(h=>{const u=t(e[h]);if(u)return u;const{def:a,path:w,params:y}=e[h];if(a.tag==="composite"){if(a.value.length===0)return F;if(a.value.length===1){const v=c(a.value[0].type);return o&&w.at(-1)==="AccountId32"&&yt(v,32)?(o=!1,{type:"AccountId32"}):i&&w.at(-1)==="AccountId20"&&yt(v,20)?(i=!1,{type:"AccountId20"}):v}return d(a.value)}if(a.tag==="variant"){if(w.length===1&&w[0]==="Option"&&y.length===1&&y[0].name==="T"){const A=c(y[0].type);return A.type==="void"?{type:"primitive",value:"bool"}:{type:"option",value:A}}if(w.length===1&&w[0]==="Result"&&y.length===2&&y[0].name==="T"&&y[1].name==="E")return{type:"result",value:{ok:c(y[0].type),ko:c(y[1].type)}};if(a.value.length===0)return F;const v={},E={};return a.value.forEach(A=>{const O=A.name;if(E[O]=A.docs,A.fields.length===0){v[O]={...F,idx:A.index};return}if(A.fields.length===1&&!A.fields[0].name){v[O]={type:"lookupEntry",value:c(A.fields[0].type),idx:A.index};return}v[O]={...d(A.fields),idx:A.index}}),{type:"enum",value:v,innerDocs:E}}if(a.tag==="sequence")return{type:"sequence",value:c(a.value)};if(a.tag==="array"){const{len:v}=a.value,E=c(a.value.type);return!v||E.type==="void"?F:v>1?{type:"array",value:E,len:a.value.len}:E}if(a.tag==="tuple")return a.value.length===0?F:a.value.length>1?g(a.value.map(v=>c(v)),a.value.map(v=>e[v].docs)):c(a.value[0]);if(a.tag==="primitive")return{type:"primitive",value:a.value.tag};if(a.tag==="compact"){const v=c(a.value);return v.type==="void"?F:{type:"compact",isBig:Number(v.value.slice(1))>32,size:v.value}}return{type:a.tag,isLSB:(e[a.value.bitOrderType].path.at(-1)??"LSB").toUpperCase().startsWith("LSB")}}),d=h=>{let u=!0;const a={},w={};return h.forEach((y,v)=>{u=u&&!!y.name;const E=y.name||v,A=c(y.type);A.type!=="void"&&(a[E]=A,w[E]=y.docs)}),u?{type:"struct",value:a,innerDocs:w}:g(Object.values(a),Object.values(w))},g=(h,u)=>{if(h.every(a=>a.id===h[0].id)&&u.every(a=>!a.length)){const[a]=h;return a.type==="void"?F:{type:"array",value:h[0],len:h.length}}return{type:"tuple",value:h,innerDocs:u}};return c},qn=e=>{const t=Kn(e.lookup,({def:r})=>{if(r.tag==="composite"){const o=n(r);if(o)return{type:"enum",innerDocs:{},value:Object.fromEntries(e.pallets.map(i=>[i.name,i.errors==null?{...F,idx:i.index}:{type:"lookupEntry",value:t(i.errors.type),idx:i.index}])),byteLength:o}}return null});function n(r){if(!(r.value.length===2&&r.value[0].name==="index"&&r.value[1].name==="error"))return null;const i=t(r.value[0].type),c=t(r.value[1].type);return i.type==="primitive"&&i.value==="u8"&&c.type==="array"&&c.value.type==="primitive"&&c.value.value==="u8"?1+c.len:null}return Object.assign(t,{metadata:e,call:"call"in e.extrinsic?e.extrinsic.call:e.lookup[e.extrinsic.type]?.params.find(i=>i.name==="Call")?.type??null})},Ae=()=>new Error("Unkown signer"),Wn=e=>{const{extrinsic:t}=e,n=qn(e);let s,r;if("address"in t)s=n(t.address),r=n(t.signature);else{const o=Object.fromEntries(e.lookup[t.type].params.filter(i=>i.type!=null).map(i=>[i.name,n(i.type)]));if(s=o.Address,r=o.Signature,!s||!r)throw Ae()}if(s.type==="AccountId20"&&r.type==="array"&&r.len===65&&r.value.type==="primitive"&&r.value.value==="u8")return[1,[]];if(r.type!=="enum"||["Ecdsa","Ed25519","Sr25519"].some(o=>!(o in r.value)))throw Ae();if(s.type==="enum"){const o=s.value.Id;if(o.type==="lookupEntry"&&o.value.type==="AccountId32")return[0,[o.idx]]}else if(s.type==="AccountId32")return[0,[]];throw Ae()},Xn=(e,t,n,s,r,o)=>{const[i,c]=Wn(e),d=ct([Hn.enc({version:4,type:"signed"}),i===1?t:new Uint8Array([...c,...t]),n,...s,r]);return ct([D.enc(d.length),d])},Y=(e,t)=>{let n=e.toString(16);n=(n.length%2?"0":"")+n;const s=Math.max(0,(t||0)-n.length/2);return"0x"+"00".repeat(s)+n},Gn=({additionalSigned:e})=>({genesisHash:H(e)}),zn=({value:e})=>({nonce:Y(D.dec(e),4)}),Yn=({additionalSigned:e})=>({transactionVersion:Y(V.dec(e),4)}),Jn=ye({tip:D,asset:ge(q(1/0))}).dec;var gt=Object.freeze({__proto__:null,ChargeAssetTxPayment:({value:e})=>{const{tip:t,asset:n}=Jn(e);return{...n?{assetId:H(n)}:{},tip:Y(t,16)}},ChargeTransactionPayment:({value:e})=>({tip:Y(dn.dec(e),16)}),CheckGenesis:Gn,CheckMetadataHash:({value:e,additionalSigned:t})=>e.length&&e[0]?{mode:1,metadataHash:H(t.length?t.slice(1):t)}:{},CheckMortality:({value:e,additionalSigned:t},n)=>({era:H(e),blockHash:H(t),blockNumber:Y(n,4)}),CheckNonce:zn,CheckSpecVersion:({additionalSigned:e})=>({specVersion:Y(V.dec(e),4)}),CheckTxVersion:Yn});const Qn=hn().enc,Zn=e=>e.startsWith("0x")?ee(e):Qn(e);function mt(e,t,n){const s=i=>n({address:e,data:H(i),type:"bytes"}).then(({signature:c})=>ee(c)),r=Zn(e);return{publicKey:r,signTx:async(i,c,d,g,h=Fn)=>{const u=$n(Pn(d)),a={};a.signedExtensions=[];const{version:w}=u.extrinsic,y=[];u.extrinsic.signedExtensions.map(({identifier:O})=>{const te=c[O];if(!te)throw new Error(`Missing ${O} signed-extension`);if(y.push(te.value),a.signedExtensions.push(O),!gt[O]){if(te.value.length===0&&te.additionalSigned.length===0)return;throw new Error(`PJS does not support this signed-extension: ${O}`)}Object.assign(a,gt[O](te,g))});const v=w.includes(4)?4:null;if(v==null)throw new Error("Only extrinsic v4 is supported");a.address=e,a.method=H(i),a.version=v,a.withSignedTransaction=!0;const E=await t(a),A=E.signedTransaction;return A?typeof A=="string"?ee(A):A:Xn(u,r,ee(E.signature),y,i)},signBytes:s}}const er=new Set(["ed25519","sr25519","ecdsa","ethereum"]),tr=async(e,t)=>{let n=window.injectedWeb3?.[e];if(!n)throw new Error(`Unavailable extension: "${e}"`);const s=await n.enable(t),r=s.signer.signPayload.bind(s.signer),o=s.signer.signRaw.bind(s.signer),i=h=>h.filter(({type:u})=>er.has(u)).map(u=>{const a=mt(u.address,r,o);return{...u,polkadotSigner:a}});let c=i(await s.accounts.get());const d=new Set,g=s.accounts.subscribe(h=>{c=i(h),d.forEach(u=>{u(c)})});return{name:e,getAccounts:()=>c,subscribe:h=>(d.add(h),()=>{d.delete(h)}),disconnect:()=>{g()}}},nr=()=>{const{injectedWeb3:e}=window;return e?Object.keys(e):[]};K.connectInjectedExtension=tr,K.getInjectedExtensions=nr,K.getPolkadotSignerFromPjs=mt});
